name: Build Mommy Turbo
on:
  workflow_dispatch: # æ”¯æŒæ‰‹åŠ¨ç‚¹å‡»å¼€å§‹

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: ğŸ› ï¸ æ ¸å¿ƒæ‰‹æœ¯ï¼šAPI + æé€Ÿ + æ”¹å
        run: |
          # 1. æ³¨å…¥ä½ çš„ API (BuildVars.java)
          find TMessagesProj/ -name "BuildVars.java" -exec sed -i 's/public static int APP_ID = .*/public static int APP_ID = 37274250;/g' {} +
          find TMessagesProj/ -name "BuildVars.java" -exec sed -i 's/public static String APP_HASH = .*/public static String APP_HASH = "5205cbdae6cecc6ce1bd494b5685fe16";/g' {} +
          
          # 2. å…¨å±€æ”¹åï¼šå°† Nekogram æ›¿æ¢ä¸º Mommy
          find . -name "strings.xml" -type f -exec sed -i 's/Nekogram/Mommy/g' {} +
          
          # 3. æš´åŠ›æé€Ÿï¼šå°†ä¸Šä¼ å’Œä¸‹è½½çš„æ‰€æœ‰å¹¶å‘é™åˆ¶å…¨éƒ¨å¼ºæ”¹è‡³ 32
          find TMessagesProj/ -name "FileLoader.java" -exec sed -i 's/currentUploadOperationsCount < [0-9]/currentUploadOperationsCount < 32/g' {} +
          find TMessagesProj/ -name "FileLoadOperation.java" -exec sed -i 's/currentDownloadOperationsCount < [0-9]/currentDownloadOperationsCount < 32/g' {} +
          find TMessagesProj/ -name "FileLoadOperation.java" -exec sed -i 's/maxDownloadCount = [0-9]/maxDownloadCount = 32/g' {} +

      - name: set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: gradle

      - name: ğŸ—ï¸ äº‘ç«¯ç¼–è¯‘ APK
        run: |
          chmod +x gradlew
          ./gradlew assembleDebug

      - name: ğŸ“¦ å¯¼å‡º Mommy å®‰è£…åŒ…
        uses: actions/upload-artifact@v4
        with:
          name: Mommy-Turbo-APK
          path: app/build/outputs/apk/debug/*.apk
